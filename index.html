<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<<<<<<< Updated upstream
    <title>Krankomat Modern</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.tailwindcss.com https://raw.githubusercontent.com;">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {},
        },
        plugins: [],
      }
    </script>
=======
    <title>Krankomat WebApp</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://unpkg.com https://cdn.tailwindcss.com;">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
>>>>>>> Stashed changes
    <style>
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
<<<<<<< Updated upstream
        font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
      }
=======
        background-color: #f8fafc; /* bg-slate-50 */
        font-family: 'Inter', sans-serif; /* A more modern font, falls back to sans-serif */
      }
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
>>>>>>> Stashed changes
    </style>
    <!-- React and ReactDOM from CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel Standalone for JSX/TSX transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>

    <script type="text/babel">
      // All application code is consolidated into this single script block.
      // The browser will transpile and run it on the fly thanks to Babel.
      const { useState, useEffect, useMemo, useCallback } = React;

      // --- UTILS ---
      const todayFormatted = () => {
        const today = new Date();
        const day = String(today.getDate()).padStart(2, '0');
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const year = today.getFullYear();
        return `${day}.${month}.${year}`;
      };

      const getDayOfWeek = (dateStr) => {
        const parts = dateStr.match(/(\d{2})\.(\d{2})\.(\d{4})/);
        if (!parts) return null;
        const date = new Date(`${parts[3]}-${parts[2]}-${parts[1]}`);
        if (isNaN(date.getTime())) return null;
        const days = ['Sonntag', 'Montag', 'Dienstag', 'Mittwoch', 'Donnerstag', 'Freitag', 'Samstag'];
        return days[date.getDay()];
      };

      const renderTemplate = (template, context) => {
        return Object.entries(context).reduce((acc, [key, value]) => {
            return acc.replace(new RegExp(`{${key}}`, 'g'), value || '');
        }, template);
      };

      const copyToClipboard = (text, onComplete) => {
        navigator.clipboard.writeText(text).then(() => {
          if (onComplete) onComplete();
        }).catch(err => {
          console.error('Failed to copy text: ', err);
        });
      };

      // --- CONSTANTS ---
      const DEFAULT_USER_DATA = {
        firstName: 'Max',
        lastName: 'Mustermann',
        studentId: '1234567',
<<<<<<< Updated upstream
        email: 'max.mustermann@example.com',
=======
        email: '',
>>>>>>> Stashed changes
        studyProgram: 'E-Government',
      };

      const RECIPIENTS_DATA_STRUCTURE = [
        { id: 1, anrede: 'Sehr geehrte Damen und Herren vom ZPD', module: 'ZPD (Zentrum für Personaldienste)', isSelected: true },
<<<<<<< Updated upstream
        { id: 2, anrede: 'Sehr geehrter Herr Angelstein', module: 'Projektmanagement', isSelected: true },
      ];

      const TIMETABLE_DATA = [
          { day: 'Montag', module: 'IT-Projektmanagement' },
          { day: 'Dienstag', module: 'Grundlagen der BWL' },
          { day: 'Mittwoch', module: 'Datenbanken' },
          { day: 'Donnerstag', module: 'Software Engineering' },
          { day: 'Freitag', module: 'IT-Projektmanagement' },
      ];

      const EMAIL_SUBJECT_TEMPLATE = "{art} E-Gov 2025 {Datum} [{Vornamen} {Nachname}, {Matrikelnummer}]";
      
      // --- COMPONENTS ---
      const DarkModeToggle = ({ isDarkMode, toggleDarkMode }) => {
        return (
          <button
            onClick={toggleDarkMode}
            className="relative inline-flex items-center h-8 w-14 cursor-pointer rounded-full bg-slate-200 dark:bg-slate-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900"
            aria-label="Toggle dark mode"
          >
            <span className="sr-only">Toggle dark mode</span>
            <span
              className={`${
                isDarkMode ? 'translate-x-7' : 'translate-x-1'
              } absolute left-0 inline-flex h-6 w-6 transform items-center justify-center rounded-full bg-white shadow-lg transition-transform duration-300 ease-in-out`}
            >
              {isDarkMode ? (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="currentColor" className="h-4 w-4 text-indigo-500 transition-opacity duration-200">
                  <path d="M223.5 32C100 32 0 132.3 0 256S100 480 223.5 480c60.6 0 115.5-24.2 155.8-63.4c5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-20 2.6-30.6 2.6c-96.8 0-175.5-78.8-175.5-176c0-65.8 36-123.1 89.3-153.3c6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"/>
                </svg>
              ) : (
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="h-5 w-5 text-amber-500 transition-opacity duration-200">
                  <path fillRule="evenodd" d="M12 2.25c.414 0 .75.336.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.592a.75.75 0 01-1.061-1.061l1.591-1.591a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.836 17.894a.75.75 0 011.06 0l1.591 1.591a.75.75 0 01-1.06 1.061l-1.591-1.591a.75.75 0 010-1.06zM12 18a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V18.75a.75.75 0 01.75-.75zM4.106 17.894a.75.75 0 010-1.06l1.591-1.591a.75.75 0 111.061 1.06l-1.591 1.592a.75.75 0 01-1.06 0zM3 12a.75.75 0 01.75-.75h2.25a.75.75 0 010 1.5H3.75A.75.75 0 013 12zM6.106 6.106a.75.75 0 011.06 0l1.591 1.591a.75.75 0 01-1.06 1.061L6.106 7.167a.75.75 0 010-1.06z" clipRule="evenodd" />
                </svg>
              )}
            </span>
          </button>
        );
      };
      
      const Header = ({ isDarkMode, toggleDarkMode, onMensaToggle }) => (
        <header className="bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm shadow-sm sticky top-0 z-20 transition-colors duration-300 border-b border-slate-200 dark:border-slate-800">
          <div className="container mx-auto px-4 lg:px-8 py-4">
            <div className="flex items-center justify-between">
              <div className="flex items-center space-x-4">
                <svg 
                  xmlns="http://www.w3.org/2000/svg" 
                  className="h-10 w-10 text-indigo-600"
                  viewBox="0 0 24 24"
                >
                  <path 
                    fill="currentColor" 
                    d="M19 14h-3v3h-2v-3h-3v-2h3V9h2v3h3m3-9H2c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h12.1c-.08-.33-.12-.66-.12-1c0-2.71 1.7-5.02 4-6.09V6l-8 5l-8-5h16v2.09c.72.2 1.39.57 2 .9V6c0-1.11-.89-2-2-2m-2 2L12 9L4 5h16Z"
                  />
                </svg>
                <div>
                  <h1 className="text-2xl lg:text-3xl font-bold text-slate-800 dark:text-white">
                    Krankomat <span className="text-indigo-600">WebApp</span>
                  </h1>
                  <p className="text-xs lg:text-sm text-slate-500 dark:text-slate-400 mt-1 hidden sm:block">
                    Das Krankomat-Entwicklerteam: Fabian Flocken, Laurin Bennet Jaetschmann, Marvin Junk und Cederic Langpaap
                  </p>
                </div>
              </div>
              <div className="flex items-center space-x-2 sm:space-x-4">
                <button 
                    onClick={onMensaToggle}
                    className="p-2 rounded-full text-slate-500 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700/60 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 dark:focus:ring-offset-slate-900 transition-colors"
                    aria-label="Mensa-Menü anzeigen"
                    title="Mensa-Menü anzeigen"
                >
                    <svg className="h-6 w-6" viewBox="80 50 380 310" fill="currentColor">
                      <path d="M 440.849 143.712 L 444.903 139.742 C 447.227 137.522 448.496 134.773 448.574 131.788 C 448.661 128.318 447.146 124.743 444.297 121.716 C 441.451 118.689 438.09 117.076 434.83 117.171 C 432.479 117.241 430.298 118.249 428.427 120.003 C 423.344 112.065 417.517 104.59 411.07 97.771 L 412.971 95.462 C 414.707 93.351 414.629 90.168 412.794 88.213 C 411.84 87.202 410.569 86.66 409.21 86.688 C 407.846 86.717 406.526 87.352 405.591 88.43 C 405.003 89.106 404.373 89.839 403.77 90.538 C 403.285 90.088 402.79 89.642 402.295 89.198 C 403.03 88.382 403.776 87.556 404.484 86.765 C 406.388 84.647 406.376 81.388 404.454 79.347 L 404.154 79.028 C 403.222 78.036 401.977 77.491 400.649 77.5 C 399.296 77.503 398.022 78.081 397.065 79.117 L 394.081 82.354 C 393.535 81.93 392.983 81.512 392.432 81.098 C 393.541 79.946 394.66 78.785 395.712 77.688 C 396.69 76.674 397.23 75.319 397.239 73.877 C 397.245 72.461 396.735 71.138 395.802 70.143 L 395.499 69.824 C 393.583 67.783 390.518 67.77 388.53 69.789 C 386.908 71.437 385.21 73.156 383.468 74.92 C 382.871 74.534 382.259 74.161 381.651 73.788 C 383.48 72.018 385.267 70.286 386.962 68.628 C 387.978 67.639 388.575 66.236 388.605 64.782 C 388.635 63.337 388.125 61.978 387.127 60.919 C 385.294 58.971 382.307 58.885 380.322 60.722 L 372.054 68.376 C 352.756 58.559 332.103 53.555 310.634 53.555 C 232.09 53.555 168.19 121.512 168.187 205.045 C 168.19 232.357 175.16 259.093 188.289 282.489 C 187.908 282.878 187.674 283.118 187.635 283.159 C 185.371 285.331 184.135 287.994 184.066 290.864 C 183.988 294.038 185.341 297.271 187.878 299.966 C 190.412 302.661 193.45 304.1 196.434 304.02 C 198.233 303.969 199.927 303.325 201.466 302.231 C 204.174 305.659 206.993 308.973 209.953 312.117 C 217.642 320.295 226.165 327.474 235.38 333.603 C 234.586 338.193 234.076 342.61 233.77 346.641 C 233.668 347.917 234.097 349.122 234.906 349.98 C 235.233 350.328 235.62 350.618 236.061 350.838 C 237.578 351.584 239.318 351.256 240.502 350.002 C 243.201 347.145 245.912 344.278 248.623 341.407 C 268.062 351.425 288.913 356.531 310.634 356.534 C 389.181 356.531 453.081 288.574 453.081 205.045 C 453.081 183.654 448.948 163.033 440.849 143.712 Z M 426.217 122.382 L 403.602 148.48 C 399.218 140.399 393.91 132.875 387.762 126.079 L 409.021 100.259 C 415.433 107.061 421.2 114.483 426.217 122.382 Z M 401.416 151.006 L 358.457 200.583 C 357.327 201.926 354.835 204.7 352.316 207.478 C 348.027 212.211 342.275 215.002 336.116 215.333 C 329.044 215.719 322.39 218.864 317.382 224.19 L 254.267 291.308 C 252.99 292.669 251.814 294.105 250.683 295.568 C 242.215 289.257 234.727 281.635 228.381 272.886 C 258.232 239.836 305.842 187.099 317.241 174.332 C 321.184 169.912 323.904 167.227 329.881 167.667 C 343.565 168.678 357.555 162.42 367.304 150.93 L 385.711 128.573 C 391.829 135.369 397.107 142.896 401.416 151.006 Z M 171.288 205.045 C 171.288 123.33 233.8 56.85 310.634 56.85 C 331.182 56.85 350.96 61.56 369.484 70.755 L 342.035 96.17 C 331.806 92.847 321.25 91.144 310.634 91.166 C 282.043 91.153 255.131 103.017 234.861 124.577 C 214.592 146.133 203.433 174.753 203.445 205.156 C 203.424 222.662 207.302 240.053 214.604 255.62 C 203.709 266.744 194.94 275.696 190.598 280.132 C 177.991 257.406 171.288 231.506 171.288 205.045 Z M 312.277 148.933 C 312.658 155.404 310.139 158.293 305.998 162.478 C 294.446 174.141 248.108 221.418 216.952 253.225 C 210.145 238.347 206.525 221.811 206.546 205.16 C 206.534 175.63 217.369 147.839 237.054 126.905 C 256.735 105.974 282.87 94.451 310.637 94.461 C 320.294 94.442 329.887 95.937 339.226 98.769 L 327.995 109.166 C 317.292 119.448 311.417 134.314 312.277 148.933 Z M 201.379 298.018 C 199.9 299.765 198.209 300.674 196.353 300.725 C 194.23 300.783 191.995 299.686 190.07 297.635 C 188.142 295.588 187.11 293.212 187.164 290.95 C 187.212 288.976 188.067 287.181 189.743 285.573 C 190.748 284.546 290.41 182.761 308.13 164.87 C 312.658 160.296 315.825 156.463 315.369 148.726 C 314.569 135.101 320.066 121.228 330.052 111.635 L 382.358 63.206 C 383.117 62.501 384.251 62.52 384.979 63.295 C 385.33 63.668 385.519 64.172 385.507 64.711 C 385.495 65.279 385.267 65.808 384.868 66.201 C 378.643 72.279 371.367 79.254 364.188 86.133 C 354.85 95.086 346.027 103.54 339.594 109.941 C 337.342 112.18 336.838 115.436 338.452 117.35 L 338.998 118 C 339.684 118.82 340.635 119.257 341.715 119.302 C 343.19 119.359 344.749 118.667 345.997 117.395 C 352.268 111 360.871 102.309 369.67 93.421 C 376.939 86.076 384.341 78.6 390.668 72.174 C 391.433 71.399 392.591 71.39 393.31 72.155 L 393.61 72.474 C 393.955 72.841 394.144 73.332 394.141 73.858 C 394.138 74.413 393.925 74.936 393.544 75.335 C 387.513 81.611 380.496 88.857 373.56 96.014 C 364.554 105.314 355.686 114.467 349.296 121.18 C 348.072 122.465 347.37 124.105 347.364 125.677 C 347.358 126.825 347.742 127.865 348.444 128.611 L 349.02 129.227 C 349.719 129.967 350.699 130.375 351.776 130.368 C 353.257 130.365 354.802 129.613 356.01 128.308 C 363.288 120.475 373.677 109.201 383.789 98.227 L 399.278 81.423 C 399.65 81.021 400.142 80.795 400.664 80.795 C 401.158 80.792 401.62 80.989 401.962 81.356 L 402.265 81.678 C 402.982 82.44 402.976 83.678 402.247 84.488 C 393.397 94.314 382.382 106.526 372.762 117.19 L 359.561 131.829 C 358.367 133.156 357.714 134.814 357.771 136.377 C 357.81 137.522 358.235 138.558 358.997 139.27 L 359.609 139.853 C 361.408 141.563 364.47 141.027 366.575 138.632 C 372.729 131.638 380.931 122.057 389.613 111.912 C 395.931 104.532 402.31 97.079 407.87 90.662 C 408.242 90.235 408.74 89.993 409.273 89.983 C 410.77 89.954 411.645 92.072 410.638 93.29 L 364.998 148.732 C 355.881 159.473 342.836 165.323 330.094 164.382 C 322.897 163.849 319.442 167.077 314.991 172.062 C 298.168 190.907 202.378 296.914 201.379 298.018 Z M 353.584 100.759 C 357.567 96.916 361.852 92.809 366.263 88.58 C 370.651 84.376 375.047 80.16 379.246 76.11 C 379.881 76.492 380.505 76.891 381.132 77.287 C 376.741 81.729 372.126 86.392 367.535 91.029 C 363.771 94.831 360.059 98.584 356.532 102.15 C 355.56 101.668 354.571 101.215 353.584 100.759 Z M 354.103 104.609 C 350.318 108.439 346.819 111.989 343.853 115.012 C 343.106 115.778 342.317 116.026 341.831 116.007 C 341.589 116.001 341.433 115.927 341.304 115.803 L 340.758 115.156 C 340.419 114.751 340.626 113.427 341.709 112.346 C 344.441 109.632 347.622 106.526 351.08 103.18 C 352.1 103.636 353.101 104.121 354.103 104.609 Z M 366.482 107.919 C 369.481 104.819 372.588 101.614 375.719 98.38 C 380.631 93.309 385.567 88.213 390.182 83.432 C 390.755 83.86 391.322 84.297 391.886 84.733 L 381.576 95.918 C 377.338 100.517 373.065 105.154 368.98 109.581 C 368.162 109.016 367.322 108.468 366.482 107.919 Z M 366.761 111.992 C 361.942 117.213 357.477 122.041 353.806 125.993 C 353.068 126.787 352.268 127.071 351.761 127.074 C 351.587 127.074 351.35 127.042 351.209 126.892 L 350.636 126.283 C 350.489 126.13 350.462 125.875 350.462 125.69 C 350.465 125.157 350.732 124.306 351.476 123.524 C 355.066 119.751 359.453 115.194 364.194 110.286 C 365.064 110.841 365.912 111.415 366.761 111.992 Z M 377.77 116.403 C 385.141 108.229 393.082 99.426 400.148 91.584 C 400.661 92.037 401.17 92.499 401.671 92.965 C 397.119 98.246 392.207 103.987 387.322 109.696 C 384.805 112.636 382.337 115.516 379.938 118.313 C 379.231 117.659 378.508 117.025 377.77 116.403 Z M 377.851 120.75 C 372.792 126.643 368.153 132.02 364.314 136.383 C 363.297 137.535 362.05 137.755 361.672 137.394 L 361.063 136.814 C 360.922 136.712 360.877 136.508 360.865 136.253 C 360.847 135.736 361.084 134.904 361.798 134.109 L 374.999 119.474 C 375.203 119.248 375.416 119.012 375.62 118.785 C 376.382 119.423 377.122 120.077 377.851 120.75 Z M 236.031 330.14 C 223.937 321.947 213.105 311.853 203.811 300.084 C 205.095 298.665 213.944 288.868 226.24 275.256 C 228.945 278.952 231.806 282.499 234.897 285.787 C 239.171 290.332 243.819 294.459 248.779 298.164 C 242.074 307.888 238.211 319.354 236.031 330.14 Z M 238.316 347.668 C 237.938 348.067 237.524 347.926 237.363 347.847 C 237.198 347.764 236.811 347.502 236.853 346.909 C 238.091 330.806 242.494 308.494 256.459 293.639 L 319.574 226.518 C 324.036 221.772 329.968 218.969 336.275 218.624 C 343.223 218.248 349.713 215.104 354.547 209.765 C 357.099 206.952 359.618 204.139 360.751 202.8 L 429.657 123.272 C 431.18 121.467 432.952 120.523 434.917 120.466 C 437.316 120.396 439.871 121.668 442.108 124.047 C 444.342 126.426 445.542 129.144 445.476 131.695 C 445.422 133.784 444.534 135.669 442.819 137.302 L 368.072 210.556 C 365.909 212.619 268.209 316.024 238.316 347.668 Z M 410.347 173.608 C 413.211 183.741 414.725 194.326 414.725 205.16 C 414.734 234.689 403.899 262.477 384.218 283.411 C 364.533 304.345 338.401 315.868 310.634 315.858 C 299.436 315.858 288.514 313.913 278.081 310.232 C 326.402 259.102 368.812 214.278 370.159 212.996 L 410.347 173.608 Z M 310.634 353.24 C 289.75 353.236 269.696 348.392 250.965 338.926 C 259.212 330.2 267.471 321.459 275.583 312.876 C 286.781 317.029 298.567 319.153 310.634 319.153 C 339.226 319.162 366.137 307.298 386.407 285.742 C 406.676 264.183 417.835 235.566 417.823 205.16 C 417.823 193.455 416.144 182.012 412.896 171.108 L 438.431 146.085 C 446.07 164.685 449.98 184.496 449.983 205.045 C 449.983 286.756 387.471 353.236 310.634 353.24 Z" style={{ strokeWidth: '1px' }}></path>
                    </svg>
                </button>
                <DarkModeToggle isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} />
=======
        { id: 2, anrede: 'Sehr geehrter Herr Angelstein', module: 'Projektmanagement', isSelected: false },
      ];

      const TIMETABLE_DATA = [
          { day: 'Montag', module: 'Projektmanagement' },
          { day: 'Dienstag', module: 'Grundlagen der BWL' },
          { day: 'Mittwoch', module: 'Datenbanken' },
          { day: 'Donnerstag', module: 'Software Engineering' },
          { day: 'Freitag', module: 'Grundlagen Informatik' },
      ];

      const EMAIL_SUBJECT_TEMPLATE = "{art} EGOV 2025 {Datum} [{Vornamen} {Nachname}, {Matrikelnummer}]";
      
      // --- COMPONENTS ---
      const Header = () => (
        <header className="bg-white shadow-sm">
          <div className="container mx-auto px-4 lg:px-8 py-5">
            <div className="flex items-center space-x-3">
              <i className="fa-solid fa-file-medical text-3xl text-indigo-600"></i>
              <div>
                <h1 className="text-3xl font-bold text-slate-800">
                  Krankomat <span className="text-indigo-600">WebApp</span>
                </h1>
                <p className="text-slate-500 mt-1">

Das Krankomat-Entwicklerteam:

Fabian Flocken, 
Laurin Bennet Jaetschmann, 
Marvin Junk und
Cederic Langpaap
</p>
>>>>>>> Stashed changes
              </div>
            </div>
          </div>
        </header>
      );

<<<<<<< Updated upstream
      const Disclaimer = ({ onDismiss }) => (
        <div className="mb-8 p-4 bg-amber-50 dark:bg-amber-900/20 border-l-4 border-amber-400 dark:border-amber-500 rounded-r-lg shadow-md" role="alert">
          <div className="flex">
            <div className="py-1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" className="h-8 w-8 text-amber-500 dark:text-amber-400 mr-4 flex-shrink-0">
                <path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480H40c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24V296c0 13.3 10.7 24 24 24s24-10.7 24-24V184c0-13.3-10.7-24-24-24zm32 224c0-17.7-14.3-32-32-32s-32 14.3-32 32s14.3 32 32 32s32-14.3 32-32z"/>
              </svg>
            </div>
            <div>
              <p className="font-bold text-amber-800 dark:text-amber-200">Hinweis</p>
              <p className="text-sm text-amber-700 dark:text-amber-300">
                Dieses Werkzeug ist eine E-Mail Schreibhilfe. Alle Daten bleiben auf dem Gerät. 
              </p>
            </div>
            <div className="ml-auto pl-3">
              <button onClick={onDismiss} className="text-amber-500 hover:text-amber-700 dark:text-amber-400 dark:hover:text-amber-200 focus:outline-none focus:ring-2 focus:ring-amber-500 rounded-full h-8 w-8 flex items-center justify-center transition-colors" aria-label="Disclaimer ausblenden">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512" fill="currentColor" className="h-5 w-5">
                  <path d="M310.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L160 210.7 54.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L114.7 256 9.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L160 301.3 265.4 406.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L205.3 256 310.6 150.6z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      );

      const Card = ({ title, children, className }) => (
        <div className={`bg-white dark:bg-slate-800 rounded-xl shadow-lg ${className}`}>
          <div className="p-6">
            <h2 className="text-xl font-bold text-slate-800 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-4 mb-5">
=======
      const Card = ({ title, children, className }) => (
        <div className={`bg-white rounded-xl shadow-lg ${className}`}>
          <div className="p-6">
            <h2 className="text-xl font-bold text-slate-800 border-b border-slate-200 pb-4 mb-5">
>>>>>>> Stashed changes
              {title}
            </h2>
            <div className="space-y-5">
              {children}
            </div>
          </div>
        </div>
      );

      const FormField = ({ label, id, type = 'text', value, onChange, placeholder, className }) => (
        <div className={`flex flex-col ${className}`}>
<<<<<<< Updated upstream
          <label htmlFor={id} className="mb-1.5 text-sm font-medium text-slate-600 dark:text-slate-400">{label}</label>
=======
          <label htmlFor={id} className="mb-1.5 text-sm font-medium text-slate-600">{label}</label>
>>>>>>> Stashed changes
          <input
            id={id}
            type={type}
            value={value}
            onChange={onChange}
            placeholder={placeholder}
<<<<<<< Updated upstream
            className="px-4 py-2.5 bg-white dark:bg-slate-700 border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200 text-slate-900 dark:text-white placeholder-slate-400 dark:placeholder-slate-500"
=======
            className="px-4 py-2.5 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
>>>>>>> Stashed changes
          />
        </div>
      );
      
      const Checkbox = ({ label, checked, onChange, id }) => (
        <label htmlFor={id} className="flex items-center space-x-3 cursor-pointer group">
          <div className="relative flex items-center">
            <input
              id={id}
              type="checkbox"
              checked={checked}
              onChange={onChange}
<<<<<<< Updated upstream
              className="peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-slate-400 dark:border-slate-500 transition-all checked:border-indigo-600 checked:bg-indigo-600 dark:checked:border-indigo-500 dark:checked:bg-indigo-500"
=======
              className="peer relative h-5 w-5 cursor-pointer appearance-none rounded-md border border-slate-400 transition-all checked:border-indigo-600 checked:bg-indigo-600"
>>>>>>> Stashed changes
            />
            <div className="pointer-events-none absolute top-2/4 left-2/4 -translate-y-2/4 -translate-x-2/4 text-white opacity-0 transition-opacity peer-checked:opacity-100">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-3.5 w-3.5" viewBox="0 0 20 20" fill="currentColor" stroke="currentColor" strokeWidth="1">
                    <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd"></path>
                </svg>
            </div>
          </div>
<<<<<<< Updated upstream
          <span className="text-sm text-slate-700 dark:text-slate-300 group-hover:text-indigo-600 dark:group-hover:text-indigo-400 transition-colors">
=======
          <span className="text-sm text-slate-700 group-hover:text-indigo-600 transition-colors">
>>>>>>> Stashed changes
            {label}
          </span>
        </label>
      );

      const UserInfoPanel = ({ userData, setUserData, sicknessStartDate, setSicknessStartDate, sicknessEndDate, setSicknessEndDate, onManualSave, saveStatus }) => {
        const handleUserChange = (field, value) => setUserData(prev => ({ ...prev, [field]: value }));
        const noticeType = sicknessEndDate ? 'Gesundmeldung' : 'Krankmeldung';

        const handleNoticeTypeChange = (type) => {
          if (type === 'Krankmeldung') setSicknessEndDate('');
          else if (type === 'Gesundmeldung' && !sicknessEndDate) setSicknessEndDate(todayFormatted());
        };

        return (
          <Card title="Allgemeine Informationen">
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <FormField label="Vorname" id="firstName" value={userData.firstName} onChange={(e) => handleUserChange('firstName', e.target.value)} />
              <FormField label="Nachname" id="lastName" value={userData.lastName} onChange={(e) => handleUserChange('lastName', e.target.value)} />
              <FormField label="Matrikelnummer" id="studentId" value={userData.studentId} onChange={(e) => handleUserChange('studentId', e.target.value)} />
<<<<<<< Updated upstream
              {/* <FormField label="Absender-E-Mail" id="email" type="email" value={userData.email} onChange={(e) => handleUserChange('email', e.target.value)} /> */}
            </div>
            <div className="border-t border-slate-200 dark:border-slate-700 mt-4 pt-4 space-y-4">
              <div className="p-1 flex bg-slate-100 dark:bg-slate-700 rounded-full">
                <button onClick={() => handleNoticeTypeChange('Krankmeldung')} className={`w-1/2 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${noticeType === 'Krankmeldung' ? 'bg-white dark:bg-slate-800 text-indigo-600 dark:text-indigo-400 shadow' : 'text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600'}`}>Krankmeldung</button>
                <button onClick={() => handleNoticeTypeChange('Gesundmeldung')} className={`w-1/2 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${noticeType === 'Gesundmeldung' ? 'bg-white dark:bg-slate-800 text-green-600 dark:text-green-400 shadow' : 'text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-600'}`}>Gesundmeldung</button>
=======
              <FormField label="Absender-E-Mail" id="email" type="email" value={userData.email} onChange={(e) => handleUserChange('email', e.target.value)} />
            </div>
            <div className="border-t border-slate-200 mt-4 pt-4 space-y-4">
              <div className="p-1 flex bg-slate-100 rounded-full">
                <button onClick={() => handleNoticeTypeChange('Krankmeldung')} className={`w-1/2 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${noticeType === 'Krankmeldung' ? 'bg-white text-indigo-600 shadow' : 'text-slate-600 hover:bg-slate-200'}`}>Krankmeldung</button>
                <button onClick={() => handleNoticeTypeChange('Gesundmeldung')} className={`w-1/2 py-2 text-sm font-semibold rounded-full transition-all duration-300 ${noticeType === 'Gesundmeldung' ? 'bg-white text-green-600 shadow' : 'text-slate-600 hover:bg-slate-200'}`}>Gesundmeldung</button>
>>>>>>> Stashed changes
              </div>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-end">
                <FormField label="Erster Krankheitstag" id="startDate" value={sicknessStartDate} onChange={e => setSicknessStartDate(e.target.value)} />
                <div className="flex flex-col">
                    <FormField label="Letzter Krankheitstag (optional)" id="endDate" value={sicknessEndDate} onChange={e => setSicknessEndDate(e.target.value)} />
<<<<<<< Updated upstream
                    <button onClick={() => setSicknessEndDate(todayFormatted())} className="mt-2 text-sm text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300 self-start font-medium">heute wieder gesund</button>
=======
                    <button onClick={() => setSicknessEndDate(todayFormatted())} className="mt-2 text-sm text-indigo-600 hover:text-indigo-800 self-start font-medium">heute wieder gesund</button>
>>>>>>> Stashed changes
                </div>
              </div>
            </div>
            <div className="flex justify-end pt-4 mt-2">
              <button
                onClick={onManualSave}
<<<<<<< Updated upstream
                className={`inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-indigo-500 ${
                  saveStatus === 'saved'
                    ? 'bg-green-500 dark:bg-green-600 text-white cursor-default'
                    : 'text-indigo-700 bg-indigo-100 hover:bg-indigo-200 dark:bg-indigo-500/20 dark:text-indigo-300 dark:hover:bg-indigo-500/30'
=======
                className={`inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-md shadow-sm transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 ${
                  saveStatus === 'saved'
                    ? 'bg-green-500 text-white cursor-default'
                    : 'text-indigo-700 bg-indigo-100 hover:bg-indigo-200'
>>>>>>> Stashed changes
                }`}
                disabled={saveStatus === 'saved'}
                aria-live="polite"
              >
                {saveStatus === 'saved' ? (
                  <>
<<<<<<< Updated upstream
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4 mr-2">
                      <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
                    </svg>
=======
                    <i className="fa-solid fa-check mr-2"></i>
>>>>>>> Stashed changes
                    Gespeichert!
                  </>
                ) : (
                  <>
<<<<<<< Updated upstream
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4 mr-2">
                      <path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V173.3c0-17-6.7-33.3-18.7-45.3L352 50.7C340 38.7 323.7 32 306.7 32H64zm0 96c0-17.7 14.3-32 32-32H288c17.7 0 32 14.3 32 32v64c0 17.7-14.3 32-32 32H96c-17.7 0-32-14.3-32-32V128zM224 288a64 64 0 1 1 0 128 64 64 0 1 1 0-128z"/>
                    </svg>
=======
                    <i className="fa-solid fa-floppy-disk mr-2"></i>
>>>>>>> Stashed changes
                    Speichern
                  </>
                )}
              </button>
            </div>
          </Card>
        );
      };

      const AbsencePanel = ({ reasons, onToggle }) => (
        <Card title="Heute verpasse ich...">
          <Checkbox id="lecture" label="Vorlesungszeit" checked={reasons.lecture} onChange={() => onToggle('lecture')} />
          <Checkbox id="internship" label="Berufspraxis" checked={reasons.internship} onChange={() => onToggle('internship')} />
<<<<<<< Updated upstream
          <div>
            <Checkbox id="exam" label="Prüfungsleistung / Klausur" checked={reasons.exam} onChange={() => onToggle('exam')} />
            {reasons.exam && (
              <div className="mt-3 ml-8 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-500/30 rounded-lg text-sm text-blue-800 dark:text-blue-200 flex items-start space-x-3 transition-all duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" className="h-5 w-5 text-blue-500 dark:text-blue-400 mt-1 flex-shrink-0">
                  <path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM216 336h24V272H216c-13.3 0-24-10.7-24-24s10.7-24 24-24h48c13.3 0 24 10.7 24 24v88h8c13.3 0 24 10.7 24 24s-10.7 24-24 24H216c-13.3 0-24-10.7-24-24s10.7-24 24-24zm40-208a32 32 0 1 1 0 64 32 32 0 1 1 0-64z"/>
                </svg>
                <p>
                  <strong>Wichtiger Hinweis:</strong> Diese E-Mail ersetzt nicht die offizielle Prüfungsunfähigkeitsbescheinigung, die beim Prüfungsamt eingereicht werden muss.
                </p>
              </div>
            )}
          </div>
=======
          <Checkbox id="exam" label="Prüfungsleistung / Klausur" checked={reasons.exam} onChange={() => onToggle('exam')} />
>>>>>>> Stashed changes
          <Checkbox id="partialDay" label="Rest des Tages (war schon da)" checked={reasons.partialDay} onChange={() => onToggle('partialDay')} />
        </Card>
      );
      
      const DetailsPanel = ({ details, onChange }) => {
        const commentPresets = ["nur 1 Tag krank", "vsl. ungefähr 3 Tage krank", "vsl. länger als 3 Tage, Arzt wird aufgesucht"];
        const handleCommentPresetToggle = (text) => {
          const currentComments = details.comments.split('\n').filter(line => line.trim() !== '');
          const newComments = currentComments.includes(text) ? currentComments.filter(c => c !== text) : [...currentComments, text];
          onChange('comments', newComments.join('\n'));
        };
          
        return (
          <Card title="Details & Optionen">
<<<<<<< Updated upstream
            <div className="p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-500/30 rounded-lg text-sm text-blue-800 dark:text-blue-200 flex items-start space-x-3">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="h-5 w-5 text-blue-500 dark:text-blue-400 mt-1 flex-shrink-0">
                <path fillRule="evenodd" d="M18.97 3.659a2.25 2.25 0 00-3.182 0l-10.5 10.5a.75.75 0 001.06 1.061l10.5-10.5a.75.75 0 011.06 0 2.25 2.25 0 010 3.182L6.75 18.75a3.75 3.75 0 11-5.303-5.303l7.219-7.22a.75.75 0 00-1.06-1.061l-7.22 7.22a5.25 5.25 0 007.424 7.424l10.5-10.5a3.75 3.75 0 00-5.303-5.303z" clipRule="evenodd" />
              </svg>
              <p>
                <strong>Anhänge:</strong> Dokumente wie eine eAU oder ein Attest erst in Outlook anhängen.
              </p>
            </div>
            <div>
              <label htmlFor="comments" className="mb-1.5 text-sm font-medium text-slate-600 dark:text-slate-400">Bemerkung / voraussichtliche Dauer</label>
              <textarea id="comments" value={details.comments} onChange={(e) => onChange('comments', e.target.value)} rows={3} className="w-full px-4 py-2.5 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border border-slate-300 dark:border-slate-600 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" />
=======
            <div className="grid grid-cols-2 gap-4">
              <Checkbox id="accident" label="Unfall" checked={details.isAccident} onChange={() => onChange('isAccident', !details.isAccident)} />
              <Checkbox id="gkv" label="GKV" checked={details.isGKV} onChange={() => onChange('isGKV', !details.isGKV)} />
              <Checkbox id="attest" label="Attest" checked={details.hasAttest} onChange={() => onChange('hasAttest', !details.hasAttest)} />
              <Checkbox id="eau" label="eAU" checked={details.hasEAU} onChange={() => onChange('hasEAU', !details.hasEAU)} />
            </div>
            <div className="pt-4">
              <label htmlFor="comments" className="mb-1.5 text-sm font-medium text-slate-600">Bemerkung / voraussichtliche Dauer</label>
              <textarea id="comments" value={details.comments} onChange={(e) => onChange('comments', e.target.value)} rows={3} className="w-full px-4 py-2.5 border border-slate-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" />
>>>>>>> Stashed changes
              <div className="mt-2 space-y-2">
                {commentPresets.map(preset => (<Checkbox key={preset} id={`preset-${preset}`} label={preset} checked={details.comments.includes(preset)} onChange={() => handleCommentPresetToggle(preset)} />))}
              </div>
            </div>
          </Card>
        );
      };
      
      const RecipientsPanel = ({ recipients, onToggle, onEmailChange }) => (
        <Card title="Krankmelden bei">
          <div className="max-h-80 overflow-y-auto pr-2 -mr-2 space-y-4">
            {recipients.map(recipient => (
<<<<<<< Updated upstream
              <div key={recipient.id} className="p-3 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors">
                <Checkbox id={`recipient-${recipient.id}`} checked={recipient.isSelected} onChange={() => onToggle(recipient.id)} label={recipient.module} />
                <input type="email" value={recipient.email || ''} onChange={(e) => onEmailChange(recipient.id, e.target.value)} placeholder="E-Mail-Adresse eingeben" className="ml-8 mt-2 w-[calc(100%-2rem)] px-3 py-1.5 bg-white dark:bg-slate-700 text-slate-900 dark:text-white border border-slate-300 dark:border-slate-600 rounded-md shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" aria-label={`Email for ${recipient.module}`} />
              </div>
            ))}
          </div>
=======
              <div key={recipient.id} className="p-3 rounded-lg hover:bg-slate-50 transition-colors">
                <Checkbox id={`recipient-${recipient.id}`} checked={recipient.isSelected} onChange={() => onToggle(recipient.id)} label={recipient.module} />
                <input type="email" value={recipient.email || ''} onChange={(e) => onEmailChange(recipient.id, e.target.value)} placeholder="E-Mail-Adresse eingeben" className="ml-8 mt-2 w-[calc(100%-2rem)] px-3 py-1.5 border border-slate-300 rounded-md shadow-sm text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition" aria-label={`Email for ${recipient.module}`} />
              </div>
            ))}
          </div>
          <div className="mt-4 p-4 bg-indigo-50 border border-indigo-200 rounded-lg text-sm text-indigo-800 flex items-start space-x-3">
            <i className="fa-solid fa-shield-halved text-indigo-500 mt-1"></i>
            <p><strong className="font-semibold">Datenschutzhinweis:</strong> Ihre Daten werden nur lokal in Ihrem Browser gespeichert und niemals an einen Server gesendet.</p>
          </div>
>>>>>>> Stashed changes
        </Card>
      );
      
      const CopyableField = ({ label, value }) => {
        const [copied, setCopied] = useState(false);
        const handleCopy = useCallback(() => {
          if (!value) return;
          copyToClipboard(value, () => {
            setCopied(true);
            setTimeout(() => setCopied(false), 2000);
          });
        }, [value]);

<<<<<<< Updated upstream
        const CopyIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4">
            <path d="M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"/>
          </svg>
        );
        const CheckIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4 text-green-500">
            <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
          </svg>
        );

        return (
          <div>
            <label className="text-sm font-semibold text-slate-600 dark:text-slate-300">{label}</label>
            <div className="mt-1 relative group">
              <div className="p-3 pr-10 bg-slate-100 dark:bg-slate-700/50 rounded-lg text-sm text-slate-800 dark:text-slate-200 whitespace-pre-wrap break-words font-mono border border-slate-200 dark:border-slate-700">
                {value || <span className="text-slate-400 dark:text-slate-500 font-sans italic">Wird automatisch generiert...</span>}
              </div>
              {value && (
                <button onClick={handleCopy} title="In die Zwischenablage kopieren" className="absolute top-2 right-2 p-2 rounded-md bg-white/50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-600 hover:text-indigo-600 dark:hover:text-indigo-400 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100" aria-label="Copy">
                  {copied ? <CheckIcon /> : <CopyIcon />}
=======
        return (
          <div>
            <label className="text-sm font-semibold text-slate-600">{label}</label>
            <div className="mt-1 relative group">
              <div className="p-3 pr-10 bg-slate-100 rounded-lg text-sm text-slate-800 whitespace-pre-wrap break-words font-mono border border-slate-200">
                {value || <span className="text-slate-400 font-sans italic">Wird automatisch generiert...</span>}
              </div>
              {value && (
                <button onClick={handleCopy} title="In die Zwischenablage kopieren" className="absolute top-2 right-2 p-2 rounded-md bg-white/50 text-slate-500 hover:bg-white hover:text-indigo-600 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100" aria-label="Copy">
                  <i className={`fa-solid ${copied ? 'fa-check text-green-500' : 'fa-copy'}`}></i>
>>>>>>> Stashed changes
                </button>
              )}
            </div>
          </div>
        );
      };

      const AndroidIcon = () => (
        <svg className="h-5 w-5 mr-2" viewBox="83 288 265 122" xmlns="http://www.w3.org/2000/svg">
            <path 
                fill="#32de84"
                d="m 263.837 306.59 l 21.9331 -37.9944 c 1.2377 -2.12998 0.48933 -4.83565 -1.61189 -6.07335 c -2.1012 -1.23768 -4.83565 -0.5181 -6.04456 1.61189 l -22.221 38.4837 c -16.9536 -7.74281 -36.0371 -12.0604 -56.5599 -12.0604 c -20.5227 0 -39.6063 4.31754 -56.5599 12.0604 l -22.221 -38.4837 c -1.2377 -2.12999 -3.94336 -2.84957 -6.07335 -1.61189 c -2.13 1.2377 -2.84959 3.94337 -1.61189 6.07335 l 21.9331 37.9944 c -37.8217 20.494 -63.4392 58.7762 -67.6703 103.592 h 264.407 c -4.2312 -44.8161 -29.8487 -83.0984 -67.6991 -103.592 Z m -125.209 66.4614 c -6.13092 0 -11.0817 -4.97957 -11.0817 -11.0817 c 0 -6.13093 4.97957 -11.0817 11.0817 -11.0817 c 6.13092 0 11.0817 4.97956 11.0817 11.0817 c 0.0289 6.10212 -4.95079 11.0817 -11.0817 11.0817 Z m 121.381 0 c -6.13091 0 -11.0817 -4.97957 -11.0817 -11.0817 c 0 -6.13093 4.97958 -11.0817 11.0817 -11.0817 c 6.13093 0 11.0817 4.97956 11.0817 11.0817 c 0.0288 6.10212 -4.95077 11.0817 -11.0817 11.0817 Z"
            />
        </svg>
      );

<<<<<<< Updated upstream
      const Tooltip = ({ message }) => (
        <div className="absolute bottom-full mb-2 w-max max-w-xs left-1/2 -translate-x-1/2 px-3 py-2 bg-slate-700 dark:bg-slate-800 text-white dark:text-slate-200 text-sm rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none z-10">
          {message}
          <svg className="absolute text-slate-700 dark:text-slate-800 h-2 w-full left-0 top-full" x="0px" y="0px" viewBox="0 0 255 255" xmlSpace="preserve">
            <polygon className="fill-current" points="0,0 127.5,127.5 255,0"/>
          </svg>
        </div>
      );
      
      const PreviewPanel = ({ email, editedBody, setEditedBody }) => {
        const { subject, to } = email;

        const toList = to ? to.split(';').map(e => e.trim()).filter(Boolean) : [];
        const toMailtoValue = toList.join(',');

        const finalOutlookHref = toList.length > 0 ? `https://outlook.office.com/mail/deeplink/compose?to=${encodeURIComponent(to)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(editedBody)}` : null;
        const finalMailtoHref = toList.length > 0 ? `mailto:${toMailtoValue}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(editedBody)}` : null;

        const handleOpenOutlook = () => {
          if (finalOutlookHref) {
            window.open(finalOutlookHref, '_blank', 'noopener,noreferrer');
          }
        };
        
        const [bodyCopied, setBodyCopied] = useState(false);
        const handleCopyBody = useCallback(() => {
          if (!editedBody) return;
          copyToClipboard(editedBody, () => {
            setBodyCopied(true);
            setTimeout(() => setBodyCopied(false), 2000);
          });
        }, [editedBody]);
        
        const CopyIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4">
            <path d="M208 0H332.1c12.7 0 24.9 5.1 33.9 14.1l67.9 67.9c9 9 14.1 21.2 14.1 33.9V336c0 26.5-21.5 48-48 48H208c-26.5 0-48-21.5-48-48V48c0-26.5 21.5-48 48-48zM48 128h80v64H64V448H256V416h64v48c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V176c0-26.5 21.5-48 48-48z"/>
          </svg>
        );
        const CheckIcon = () => (
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor" className="h-4 w-4 text-green-500">
            <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z"/>
          </svg>
        );

        return (
          <div className="bg-white dark:bg-slate-800 rounded-xl shadow-lg sticky top-24">
            <div className="p-6">
              <h2 className="text-xl font-bold text-slate-800 dark:text-slate-100 border-b border-slate-200 dark:border-slate-700 pb-4 mb-5">Vorschau & E-Mail</h2>
              <div className="space-y-4">
                <CopyableField label="Betreff" value={email.subject} />
                <CopyableField label="An (To)" value={email.to} />
                <div>
                  <label className="text-sm font-semibold text-slate-600 dark:text-slate-300">Nachricht</label>
                  <div className="mt-1 relative group">
                    <textarea 
                      value={editedBody}
                      onChange={(e) => setEditedBody(e.target.value)}
                      className="w-full p-3 bg-slate-100 dark:bg-slate-700/50 rounded-lg text-sm text-slate-800 dark:text-slate-200 whitespace-pre-wrap break-words h-64 overflow-y-auto border border-slate-200 dark:border-slate-700 font-mono focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200"
                      aria-label="Email message body"
                    />
                    <button onClick={handleCopyBody} title="Nachricht kopieren" className="absolute top-2 right-2 p-2 rounded-md bg-white/50 dark:bg-slate-800/50 text-slate-500 dark:text-slate-400 hover:bg-white dark:hover:bg-slate-600 hover:text-indigo-600 dark:hover:text-indigo-400 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100" aria-label="Copy message">
                      {bodyCopied ? <CheckIcon /> : <CopyIcon />}
=======
      const PreviewPanel = ({ email }) => {
        const handleOpenOutlook = () => {
          if (email && email.outlookHref) {
            window.open(email.outlookHref, '_blank', 'noopener,noreferrer');
          }
        };

        return (
          <div className="bg-white rounded-xl shadow-lg sticky top-8">
            <div className="p-6">
              <h2 className="text-xl font-bold text-slate-800 border-b border-slate-200 pb-4 mb-5">Vorschau & E-Mail</h2>
              <div className="space-y-4">
                <CopyableField label="Betreff:" value={email.subject} />
                <CopyableField label="An:" value={email.to} />
                <div>
                  <label className="text-sm font-semibold text-slate-600">Nachricht:</label>
                  <div className="mt-1 relative group">
                    <div className="p-3 bg-slate-100 rounded-lg text-sm text-slate-800 whitespace-pre-wrap break-words h-64 overflow-y-auto border border-slate-200 font-mono">
                      {email.body}
                    </div>
                    <button onClick={() => copyToClipboard(email.body, () => {})} title="Nachricht kopieren" className="absolute top-2 right-2 p-2 rounded-md bg-white/50 text-slate-500 hover:bg-white hover:text-indigo-600 transition-all opacity-0 group-hover:opacity-100 focus:opacity-100" aria-label="Copy message">
                      <i className="fa-solid fa-copy"></i>
>>>>>>> Stashed changes
                    </button>
                  </div>
                </div>
              </div>
            </div>
<<<<<<< Updated upstream
            <div className="bg-slate-50 dark:bg-slate-800/50 p-4 border-t border-slate-200 dark:border-slate-700 rounded-b-xl">
              <div className="relative group w-full">
                <button 
                  onClick={handleOpenOutlook} 
                  disabled={!finalOutlookHref}
                  className="w-full inline-flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-lg shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-indigo-500 transition-transform hover:scale-[1.02] active:scale-[0.98] disabled:bg-indigo-400 dark:disabled:bg-indigo-500/50 disabled:cursor-not-allowed">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" fill="currentColor" className="h-5 w-5 mr-3">
                    <path d="M498.1 5.6c10.1 7 15.4 19.1 13.5 31.2l-64 416c-1.5 9.7-7.4 18.2-16 23s-18.9 5.4-28 1.6L284 427.7l-68.5 74.1c-8.9 9.7-22.9 12.9-35.2 8.1S160 493.2 160 480V396.4c0-4 1.5-7.8 4.2-10.7L331.8 202.8c5.8-6.3 5.6-16-.4-22s-15.7-6.4-22-.7L106 360.8 17.7 316.6C7.1 311.3 .3 300.7 0 288.9s5.9-22.8 16.1-28.7l448-256c10.7-6.1 23.8-5.5 34 1.4z"/>
                  </svg>
                  E-Mail in Outlook öffnen
                </button>
                {!finalOutlookHref && (
                  <Tooltip message="Bitte fügen Sie mindestens einen Empfänger mit einer gültigen E-Mail-Adresse hinzu." />
                )}
              </div>
              <div className="relative group w-full mt-3">
                <a
                  href={finalMailtoHref || undefined}
                  onClick={(e) => { if (!finalMailtoHref) e.preventDefault(); }}
                  target="_blank"
                  rel="noopener noreferrer"
                  aria-disabled={!finalMailtoHref}
                  className={`w-full inline-flex items-center justify-center px-4 py-2 border border-slate-300 dark:border-slate-600 text-sm font-medium rounded-md shadow-sm text-slate-700 dark:text-slate-300 bg-white dark:bg-slate-700 transition-colors ${
                    finalMailtoHref
                      ? 'hover:bg-slate-50 dark:hover:bg-slate-600 focus:outline-none focus:ring-2 focus:ring-offset-2 dark:focus:ring-offset-slate-800 focus:ring-indigo-500'
                      : 'opacity-50 cursor-not-allowed'
                  }`}
                >
                  <AndroidIcon />
                  Öffnen mit Standard Mail-Programm
                </a>
                {!finalMailtoHref && (
                  <Tooltip message="Bitte fügen Sie mindestens einen Empfänger mit einer gültigen E-Mail-Adresse hinzu." />
                )}
              </div>
=======
            <div className="bg-slate-50 p-4 border-t border-slate-200 rounded-b-xl">
              <button 
                onClick={handleOpenOutlook} 
                disabled={!email.outlookHref}
                className="w-full inline-flex items-center justify-center px-4 py-3 border border-transparent text-base font-medium rounded-lg shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform hover:scale-[1.02] active:scale-[0.98] disabled:bg-indigo-400 disabled:cursor-not-allowed">
                <i className="fa-solid fa-paper-plane h-5 w-5 mr-3"></i>
                E-Mail in Outlook öffnen
              </button>
              <a
                href={email.mailtoHref || undefined}
                onClick={(e) => { if (!email.mailtoHref) e.preventDefault(); }}
                target="_blank"
                rel="noopener noreferrer"
                aria-disabled={!email.mailtoHref}
                className={`mt-3 w-full inline-flex items-center justify-center px-4 py-2 border border-slate-300 text-sm font-medium rounded-md shadow-sm text-slate-700 bg-white transition-colors ${
                  email.mailtoHref
                    ? 'hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500'
                    : 'opacity-50 cursor-not-allowed'
                }`}
              >
                <AndroidIcon />
                Öffnen mit Mail-App
              </a>
>>>>>>> Stashed changes
            </div>
          </div>
        );
      };

<<<<<<< Updated upstream
      const MensaPanel = ({ isOpen, onClose }) => {
        const [menu, setMenu] = useState([]);
        const [loading, setLoading] = useState(true);
        const [error, setError] = useState(null);
        const [currentDate, setCurrentDate] = useState(new Date());

        useEffect(() => {
          if (isOpen) {
            const fetchMenu = async () => {
              setLoading(true);
              setError(null);
              setMenu([]);
              
              const year = currentDate.getFullYear();
              const month = currentDate.getMonth() + 1;
              const day = currentDate.getDate();
              
              const url = `https://raw.githubusercontent.com/HAWHHCalendarBot/mensa-data/main/Mensa%20Berliner%20Tor/${year}/${month}/${day}.json`;

              try {
                const response = await fetch(url);
                if (!response.ok) {
                  throw new Error(`Heute ist leider kein Menü verfügbar oder die Mensa ist geschlossen.`);
                }
                const data = await response.json();
                setMenu(data);
              } catch (err) {
                setError(err.message || 'Fehler beim Laden der Menüdaten.');
              } finally {
                setLoading(false);
              }
            };
            fetchMenu();
          }
        }, [isOpen, currentDate]);
        
        useEffect(() => {
            const handleKeyDown = (event) => {
                if (event.key === 'Escape') {
                    onClose();
                }
            };
            if (isOpen) {
                window.addEventListener('keydown', handleKeyDown);
            }
            return () => {
                window.removeEventListener('keydown', handleKeyDown);
            };
        }, [isOpen, onClose]);

        const groupedMenu = useMemo(() => menu.reduce((acc, item) => {
            const category = item.Category || 'Sonstiges';
            if (!acc[category]) acc[category] = [];
            acc[category].push(item);
            return acc;
        }, {}), [menu]);
        
        const allAdditives = useMemo(() => {
            if (!menu || menu.length === 0) return {};
            const additivesMap = {};
            menu.forEach(item => {
                if (item.Additives) {
                    Object.entries(item.Additives).forEach(([code, description]) => {
                        const cleanCode = code.replace(/<\/?strong>/g, '');
                        if (!additivesMap[cleanCode]) {
                            additivesMap[cleanCode] = description;
                        }
                    });
                }
            });
            return additivesMap;
        }, [menu]);

        const changeDate = (days) => {
            setCurrentDate(prevDate => {
                const newDate = new Date(prevDate);
                newDate.setDate(newDate.getDate() + days);
                return newDate;
            });
        };

        if (!isOpen) return null;

        return (
          <div 
            className="fixed inset-0 bg-black bg-opacity-60 z-50 flex justify-center items-center p-4 transition-opacity duration-300"
            onClick={onClose}
            role="dialog"
            aria-modal="true"
            aria-labelledby="mensa-panel-title"
          >
            <div 
              className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col transform transition-all duration-300 scale-95 opacity-0 animate-scale-in"
              onClick={(e) => e.stopPropagation()}
            >
              <header className="p-4 sm:p-5 border-b border-slate-200 dark:border-slate-700 flex items-center justify-between flex-shrink-0">
                <div className="flex items-center space-x-4">
                    <button onClick={() => changeDate(-1)} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" aria-label="Vorheriger Tag">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clipRule="evenodd" /></svg>
                    </button>
                    <div className="text-center">
                        <h2 id="mensa-panel-title" className="text-lg font-bold text-slate-800 dark:text-slate-100">Mensa Berliner Tor</h2>
                        <p className="text-sm text-slate-500 dark:text-slate-400 font-medium">{currentDate.toLocaleDateString('de-DE', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    </div>
                    <button onClick={() => changeDate(1)} className="p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-700 transition-colors" aria-label="Nächster Tag">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clipRule="evenodd" /></svg>
                    </button>
                </div>
                <button onClick={onClose} className="p-2 rounded-full text-slate-500 hover:bg-slate-200 dark:text-slate-400 dark:hover:bg-slate-700 transition-colors" aria-label="Schließen">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
              </header>

              <main className="p-4 sm:p-6 overflow-y-auto flex-grow">
                {loading && <div className="flex justify-center items-center h-full"><div className="w-8 h-8 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div></div>}
                {error && <div className="text-center text-red-500 dark:text-red-400 p-8">{error}</div>}
                {!loading && !error && Object.keys(groupedMenu).length > 0 ? (
                    Object.entries(groupedMenu).map(([category, items]) => (
                        <div key={category} className="mb-6">
                            <h3 className="text-xl font-bold text-indigo-600 dark:text-indigo-400 mb-3 pb-2 border-b-2 border-indigo-200 dark:border-indigo-500/30">{category}</h3>
                            <div className="space-y-4">
                                {items.map((item, index) => (
                                    <div key={index} className="bg-slate-50 dark:bg-slate-700/40 p-4 rounded-lg">
                                        <h4 className="font-semibold text-slate-800 dark:text-slate-100">{item.Name}</h4>
                                        <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mt-2 text-sm gap-2">
                                            <div className="flex flex-wrap gap-2">
                                                {item.Vegan && <span className="px-2 py-0.5 bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300 rounded-full text-xs font-semibold">Vegan</span>}
                                                {item.Vegetarian && !item.Vegan && <span className="px-2 py-0.5 bg-emerald-100 text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-300 rounded-full text-xs font-semibold">Vegetarisch</span>}
                                                {item.LactoseFree && <span className="px-2 py-0.5 bg-blue-100 text-blue-800 dark:bg-blue-500/20 dark:text-blue-300 rounded-full text-xs font-semibold">Laktosefrei</span>}
                                            </div>
                                            <div className="text-left sm:text-right font-mono text-xs text-slate-600 dark:text-slate-300 flex-shrink-0">
                                                <span>Stud: <strong>{item.PriceStudent.toFixed(2)}€</strong></span> / <span>Bed: {item.PriceAttendant.toFixed(2)}€</span> / <span>Gast: {item.PriceGuest.toFixed(2)}€</span>
                                            </div>
                                        </div>
                                        {Object.keys(item.Additives).length > 0 && (
                                            <div className="mt-2 text-xs text-slate-500 dark:text-slate-400">
                                                Zusatzstoffe: {Object.keys(item.Additives).map(code => code.replace(/<\/?strong>/g, '')).join(', ')}
                                            </div>
                                        )}
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))
                ) : null}
              </main>
              {Object.keys(allAdditives).length > 0 && (
                <footer className="p-4 sm:p-5 border-t border-slate-200 dark:border-slate-700 flex-shrink-0 max-h-40 overflow-y-auto">
                    <h4 className="text-sm font-bold mb-2">Zusatzstoffe-Legende</h4>
                    <div className="text-xs text-slate-600 dark:text-slate-400 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-x-4 gap-y-1">
                        {Object.entries(allAdditives).map(([code, description]) => (
                            <div key={code}><strong>{code}:</strong> {description}</div>
                        ))}
                    </div>
                </footer>
              )}
            </div>
            <style>{`
                @keyframes scale-in {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
                .animate-scale-in { animation: scale-in 0.2s ease-out forwards; }
            `}</style>
          </div>
        );
      };

      // --- APP ---
      const loadJSONState = (key, defaultValue) => {
        try {
            const item = localStorage.getItem(key);
            return item ? JSON.parse(item) : defaultValue;
        } catch (error) {
            console.error(`Failed to load state for ${key}`, error);
            return defaultValue;
        }
      };

      const getInitialUserData = () => {
        try {
          const savedUserData = localStorage.getItem('krankomat_userData');
          return savedUserData ? { ...DEFAULT_USER_DATA, ...JSON.parse(savedUserData) } : DEFAULT_USER_DATA;
        } catch (error) {
          console.error("Failed to load user data from localStorage", error);
          return DEFAULT_USER_DATA;
        }
      };
      
      const getInitialRecipients = () => {
        try {
          const baseRecipients = RECIPIENTS_DATA_STRUCTURE.map(r => ({ ...r, email: '' }));
          const savedRecipients = localStorage.getItem('krankomat_recipients');
          if (savedRecipients) {
            const parsed = JSON.parse(savedRecipients);
            const merged = baseRecipients.map(base => {
              const saved = parsed.find(sr => sr.id === base.id);
              return { ...base, ...saved };
            });
            return merged;
          }
          return baseRecipients;
        } catch (error) {
          console.error("Failed to load recipients from localStorage", error);
          return RECIPIENTS_DATA_STRUCTURE.map(r => ({ ...r, email: '' }));
        }
      };

      function App() {
        const [isDarkMode, setIsDarkMode] = useState(() => {
            if (typeof window !== 'undefined' && localStorage.getItem('theme')) {
                return localStorage.getItem('theme') === 'dark';
            }
            return false; // Default to light theme
        });
        const [isMensaPanelOpen, setIsMensaPanelOpen] = useState(false);

        useEffect(() => {
            if (isDarkMode) {
                document.documentElement.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            }
        }, [isDarkMode]);

        const toggleDarkMode = () => setIsDarkMode(!isDarkMode);
        
        const [userData, setUserData] = useState(getInitialUserData);
        const [sicknessStartDate, setSicknessStartDate] = useState(() => loadJSONState('krankomat_sicknessStartDate', todayFormatted()));
        const [sicknessEndDate, setSicknessEndDate] = useState(() => loadJSONState('krankomat_sicknessEndDate', ''));
        const [absenceReasons, setAbsenceReasons] = useState(() => {
            const defaults = { lecture: true, internship: false, exam: false, partialDay: false };
            return { ...defaults, ...loadJSONState('krankomat_absenceReasons', {}) };
        });
        const [recipients, setRecipients] = useState(getInitialRecipients);
        const [details, setDetails] = useState(() => {
            const loadedDetails = loadJSONState('krankomat_details', {});
            return {
                comments: loadedDetails.comments || ''
            };
        });
        const [saveStatus, setSaveStatus] = useState('idle');
        const [disclaimerVisible, setDisclaimerVisible] = useState(false);
        const [editedBody, setEditedBody] = useState('');
        
        useEffect(() => {
          try {
            if (localStorage.getItem('krankomat_disclaimerDismissed') !== 'true') {
              setDisclaimerVisible(true);
            }
          } catch (error) {
            console.error("Could not access localStorage", error);
            setDisclaimerVisible(true); // Show it if localStorage fails
          }
        }, []);

        const handleDismissDisclaimer = useCallback(() => {
          try {
            localStorage.setItem('krankomat_disclaimerDismissed', 'true');
            setDisclaimerVisible(false);
          } catch (error) {
            console.error("Could not write to localStorage", error);
            setDisclaimerVisible(false); // Still hide it
          }
        }, []);
        
        useEffect(() => { localStorage.setItem('krankomat_userData', JSON.stringify(userData)); }, [userData]);
        useEffect(() => { localStorage.setItem('krankomat_sicknessStartDate', JSON.stringify(sicknessStartDate)); }, [sicknessStartDate]);
        useEffect(() => { localStorage.setItem('krankomat_sicknessEndDate', JSON.stringify(sicknessEndDate)); }, [sicknessEndDate]);
        useEffect(() => { localStorage.setItem('krankomat_absenceReasons', JSON.stringify(absenceReasons)); }, [absenceReasons]);
        useEffect(() => { localStorage.setItem('krankomat_details', JSON.stringify(details)); }, [details]);
=======
      // --- APP ---
      function App() {
        const [userData, setUserData] = useState(DEFAULT_USER_DATA);
        const [sicknessStartDate, setSicknessStartDate] = useState(todayFormatted());
        const [sicknessEndDate, setSicknessEndDate] = useState('');
        const [absenceReasons, setAbsenceReasons] = useState({ lecture: true, internship: false, exam: false, partialDay: false });
        const [recipients, setRecipients] = useState([]);
        const [details, setDetails] = useState({ isAccident: false, isGKV: false, hasAttest: false, hasEAU: false, comments: '' });
        const [saveStatus, setSaveStatus] = useState('idle');
        
        useEffect(() => {
          try {
            const savedUserData = localStorage.getItem('krankomat_userData');
            if (savedUserData) setUserData(JSON.parse(savedUserData));
            const savedRecipients = localStorage.getItem('krankomat_recipients');
            const baseRecipients = RECIPIENTS_DATA_STRUCTURE.map(r => ({ ...r, email: '' }));
            if (savedRecipients) {
              const parsed = JSON.parse(savedRecipients);
              const merged = baseRecipients.map(base => ({ ...base, ...parsed.find(sr => sr.id === base.id) }));
              setRecipients(merged);
            } else {
              setRecipients(baseRecipients);
            }
          } catch (error) {
            console.error("Failed to load data from localStorage", error);
            setRecipients(RECIPIENTS_DATA_STRUCTURE.map(r => ({ ...r, email: '' })));
          }
        }, []);

        useEffect(() => { localStorage.setItem('krankomat_userData', JSON.stringify(userData)); }, [userData]);
>>>>>>> Stashed changes
        useEffect(() => { if (recipients.length > 0) localStorage.setItem('krankomat_recipients', JSON.stringify(recipients)); }, [recipients]);

        const noticeType = sicknessEndDate ? 'Gesundmeldung' : 'Krankmeldung';

        useEffect(() => {
          const day = getDayOfWeek(sicknessStartDate);
          if (!day || recipients.length === 0) return;
          const todaysModules = TIMETABLE_DATA.filter(e => e.day.toLowerCase() === day.toLowerCase()).map(e => e.module.toLowerCase());
          setRecipients(prev => prev.map(r => ({ ...r, isSelected: r.module.includes('ZPD') || todaysModules.some(mod => r.module.toLowerCase().includes(mod)) })));
        }, [sicknessStartDate]);
        
        const handleRecipientToggle = (id) => setRecipients(recipients.map(r => r.id === id ? { ...r, isSelected: !r.isSelected } : r));
        const handleRecipientEmailChange = (id, email) => setRecipients(recipients.map(r => r.id === id ? { ...r, email } : r));
        const handleAbsenceReasonToggle = (reason) => setAbsenceReasons(prev => ({...prev, [reason]: !prev[reason]}));
        const handleDetailsChange = (key, value) => setDetails(prev => ({...prev, [key]: value}));
        
        const handleManualSave = useCallback(() => {
          try {
            localStorage.setItem('krankomat_userData', JSON.stringify(userData));
            localStorage.setItem('krankomat_recipients', JSON.stringify(recipients));
<<<<<<< Updated upstream
            localStorage.setItem('krankomat_sicknessStartDate', JSON.stringify(sicknessStartDate));
            localStorage.setItem('krankomat_sicknessEndDate', JSON.stringify(sicknessEndDate));
            localStorage.setItem('krankomat_absenceReasons', JSON.stringify(absenceReasons));
            localStorage.setItem('krankomat_details', JSON.stringify(details));
=======
>>>>>>> Stashed changes
            setSaveStatus('saved');
            setTimeout(() => setSaveStatus('idle'), 2000);
          } catch (error) {
            console.error("Manual save to localStorage failed", error);
          }
<<<<<<< Updated upstream
        }, [userData, recipients, sicknessStartDate, sicknessEndDate, absenceReasons, details]);
=======
        }, [userData, recipients]);
>>>>>>> Stashed changes

        const generatedEmail = useMemo(() => {
          const selectedRecipients = recipients.filter(r => r.isSelected);
          const anreden = [...new Set(selectedRecipients.map(r => r.anrede.trim()))];
          const anredeText = selectedRecipients.length === 0 ? 'Sehr geehrte Damen und Herren,' : `${anreden.join(',\n')},`;
          
<<<<<<< Updated upstream
          let abwesenheitsgrund = '';
          if (noticeType === 'Krankmeldung') {
              if (absenceReasons.partialDay) {
                  abwesenheitsgrund = 'Hiermit melde ich mich für den Rest des heutigen Tages krank.';
              } else {
                  const verpasst = [];
                  if (absenceReasons.lecture) verpasst.push('der Vorlesungszeit');
                  if (absenceReasons.internship) verpasst.push('der Berufspraxis');
                  if (absenceReasons.exam) verpasst.push('einer Prüfungsleistung');

                  if (verpasst.length > 0) {
                      abwesenheitsgrund = `Aufgrund meiner Krankheit kann ich heute nicht an ${verpasst.join(' sowie ')} teilnehmen.`;
                  }
              }
          }

=======
>>>>>>> Stashed changes
          const bodyTemplate = noticeType === 'Gesundmeldung' ? 
`{anrede}

hiermit melde ich mich ab dem {Datum2} wieder gesund.
Ich war vom {Datum} bis einschließlich {Datum2} krank.

Name: {Vornamen} {Nachname}
Matrikelnummer: {Matrikelnummer}
Studiengang: {studiengang}

{bemerkung}

Mit freundlichen Grüßen
{Vornamen} {Nachname}` : 
`{anrede}

hiermit melde ich mich für den {Datum} krank.
<<<<<<< Updated upstream
{abwesenheitsgrund}
=======
>>>>>>> Stashed changes
{dauermeldung}

Name: {Vornamen} {Nachname}
Matrikelnummer: {Matrikelnummer}
Studiengang: {studiengang}

{bemerkung}

Mit freundlichen Grüßen
{Vornamen} {Nachname}`;

          const context = {
            Vornamen: userData.firstName, Nachname: userData.lastName, Matrikelnummer: userData.studentId,
            Datum: sicknessStartDate, Datum2: sicknessEndDate, art: noticeType, studiengang: userData.studyProgram,
<<<<<<< Updated upstream
            anrede: anredeText, bemerkung: details.comments,
            prüfungstag: absenceReasons.exam ? 'ja' : 'nein',
            dauermeldung: sicknessEndDate ? `Ich bin voraussichtlich bis einschließlich ${sicknessEndDate} krank.` : '',
            abwesenheitsgrund: abwesenheitsgrund,
          };
          
          let body = renderTemplate(bodyTemplate.trim(), context);
          body = body.replace(/^\s*[\r\n]/gm, ''); // Removes empty lines

          const subject = renderTemplate(EMAIL_SUBJECT_TEMPLATE, context);
          const toList = selectedRecipients.map(r => r.email).filter(Boolean).filter(e => e.trim() !== '');
          
          const toValue = toList.join('; ');
          
          return { subject, body: body.trim(), to: toValue };
        }, [userData, noticeType, sicknessStartDate, sicknessEndDate, absenceReasons, recipients, details]);

        useEffect(() => {
          setEditedBody(generatedEmail.body);
        }, [generatedEmail.body]);

        return (
          <div className="bg-slate-50 dark:bg-slate-900 min-h-screen text-slate-800 dark:text-slate-300 font-sans transition-colors duration-300">
            <Header isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} onMensaToggle={() => setIsMensaPanelOpen(true)} />
            <MensaPanel isOpen={isMensaPanelOpen} onClose={() => setIsMensaPanelOpen(false)} />
            <main className="container mx-auto p-4 lg:p-8">
              {disclaimerVisible && <Disclaimer onDismiss={handleDismissDisclaimer} />}
              <div className="grid grid-cols-1 lg:grid-cols-5 gap-8">
=======
            anrede: anredeText, bemerkung: details.comments, unfall: details.isAccident ? 'ja' : 'nein',
            attest: details.hasAttest ? 'ja' : 'nein', eAU: details.hasEAU ? 'ja' : 'nein',
            prüfungstag: absenceReasons.exam ? 'ja' : 'nein',
            dauermeldung: sicknessEndDate ? `Ich bin voraussichtlich bis einschließlich ${sicknessEndDate} krank.` : '',
          };
          
          const body = renderTemplate(bodyTemplate.trim(), context).trim();
          const subject = renderTemplate(EMAIL_SUBJECT_TEMPLATE, context);
          const toList = selectedRecipients.map(r => r.email).filter(Boolean).filter(e => e.trim() !== '');
          
          // For Outlook Web link & display - uses semicolon separation
          const toValue = toList.join('; ');
          const outlookHref = toList.length > 0 ? `https://outlook.office.com/mail/deeplink/compose?to=${encodeURIComponent(toValue)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}` : null;

          // For standard mailto link (Android) - uses comma separation
          const toMailtoValue = toList.join(',');
          const mailtoHref = toList.length > 0 ? `mailto:${toMailtoValue}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}` : null;

          return { subject, body, to: toValue, outlookHref, mailtoHref };
        }, [userData, noticeType, sicknessStartDate, sicknessEndDate, absenceReasons, recipients, details]);

        return (
          <div className="bg-slate-100 min-h-screen text-slate-800 font-sans">
            <Header />
            <main className="container mx-auto p-4 lg:p-8">
              <div className="grid grid-cols-1 lg:grid-cols-5 gap-8 items-start">
>>>>>>> Stashed changes
                <div className="lg:col-span-3 space-y-8">
                  <UserInfoPanel 
                    userData={userData} 
                    setUserData={setUserData} 
                    sicknessStartDate={sicknessStartDate} 
                    setSicknessStartDate={setSicknessStartDate} 
                    sicknessEndDate={sicknessEndDate} 
                    setSicknessEndDate={setSicknessEndDate}
                    onManualSave={handleManualSave}
                    saveStatus={saveStatus} 
                  />
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <AbsencePanel reasons={absenceReasons} onToggle={handleAbsenceReasonToggle} />
                    <DetailsPanel details={details} onChange={handleDetailsChange} />
                  </div>
                  <RecipientsPanel recipients={recipients} onToggle={handleRecipientToggle} onEmailChange={handleRecipientEmailChange} />
                </div>
                <div className="lg:col-span-2">
<<<<<<< Updated upstream
                  <PreviewPanel email={generatedEmail} editedBody={editedBody} setEditedBody={setEditedBody} />
=======
                  <PreviewPanel email={generatedEmail} />
>>>>>>> Stashed changes
                </div>
              </div>
            </main>
          </div>
        );
      }

      // --- RENDER ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<React.StrictMode><App /></React.StrictMode>);
    </script>
<<<<<<< Updated upstream
<script type="module" src="/index.tsx"></script>
=======
  <script type="module" src="/index.tsx"></script>
>>>>>>> Stashed changes
</body>
</html>